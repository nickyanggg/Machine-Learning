import sys
import pandas as pd
import numpy as np

remove_feature = ['AMB_TEMP', 'CH4', 'RAINFALL', 'RH', 'SO2', 'THC', 'WD_HR', 'WIND_DIREC', 'WIND_SPEED', 'WS_HR']
input_file = sys.argv[1]
output_file = sys.argv[2]

mean_x = [0.3890339702760128 ,0.38893489030432127 ,0.3889596602972441 ,0.3891666666666709 ,0.3893347487615046 ,0.3893701344656802 ,0.3893046709129554 ,0.38907112526539706 ,0.38858103326256593 ,0.14015392781316294 ,0.14018754423212967 ,0.14043878273177585 ,0.14079617834394847 ,0.1410138004246279 ,0.14108634111818774 ,0.14112703467798954 ,0.14109518754423156 ,0.1409164897381452 ,2.1474345364472684 ,2.1503361641896603 ,2.1525123849964545 ,2.1550778485491797 ,2.155590941259724 ,2.1558032554847775 ,2.155537862703461 ,2.15373319179051 ,2.1485668789808856 ,10.116489738145802 ,10.118860580325563 ,10.128379334748777 ,10.143683651804686 ,10.156811748053801 ,10.163959660297255 ,10.168029016277437 ,10.166878980891733 ,10.16003184713377 ,12.249646142958277 ,12.254706298655375 ,12.266613588110436 ,12.284819532908733 ,12.298584571833006 ,12.305785562632723 ,12.309731068648295 ,12.3066878980892 ,12.29479830148623 ,31.895700636942674 ,31.94311748053786 ,31.980644019815994 ,32.005237084217974 ,32.01836518046709 ,32.03089171974523 ,32.0400389242746 ,32.048478414720456 ,32.057661004954 ,42.58351026185421 ,42.58492569002123 ,42.60314932767162 ,42.632696390658175 ,42.668435951875445 ,42.70099079971691 ,42.72823779193206 ,42.754246284501065 ,42.76910828025478 ,21.337756546355273 ,21.326786978060863 ,21.32554847841472 ,21.334217975937722 ,21.3501415428167 ,21.3604033970276 ,21.366595895258314 ,21.36765746638358 ,21.371549893842886]
std_x = [0.3261362427125073 ,0.32609996449482936 ,0.3260707992153601 ,0.3260553595443802 ,0.3260604395449759 ,0.3260493315586113 ,0.3260429851948129 ,0.32600696618965885 ,0.3258685437957968 ,0.1044553884759936 ,0.1044394951120645 ,0.10468680062040975 ,0.10506596283242528 ,0.10520687916933712 ,0.10519009337423026 ,0.10517679719200881 ,0.10514954200324687 ,0.10508097893680328 ,2.296097060841677 ,2.2979193549534376 ,2.297723200144478 ,2.298282546938085 ,2.298145862013244 ,2.29803601080124 ,2.297740230569873 ,2.297435076698362 ,2.292962802414261 ,6.201684346984505 ,6.2028642885802885 ,6.207359966653223 ,6.213735904431069 ,6.217247483265441 ,6.2152201231203055 ,6.213894335294034 ,6.212482579390122 ,6.21119177408577 ,7.605347753633319 ,7.608026742536853 ,7.6125156517266355 ,7.617623037096303 ,7.619149672587756 ,7.6165917617944725 ,7.615216505982224 ,7.614131449801981 ,7.61097383352692 ,18.770113276920515 ,18.786739152612988 ,18.796685227001085 ,18.798016907755027 ,18.795666604361653 ,18.790713976847297 ,18.787294069924588 ,18.78347343247971 ,18.782414106474896 ,26.29765778979889 ,26.29362965262509 ,26.28052050381642 ,26.270428904729933 ,26.27023753632154 ,26.270224152229915 ,26.261763357745878 ,26.248686982593686 ,26.236045683724825 ,16.716688325418428 ,16.69815191881457 ,16.672849122954695 ,16.65222124649511 ,16.648716819688342 ,16.64345973635901 ,16.637247992219258 ,16.624181560583327 ,16.616771094394025]

testdata = pd.read_csv(input_file, header = None, encoding = 'big5')
for rf in remove_feature:
    testdata = testdata[testdata[1] != rf]
test_data = testdata.iloc[:, 2:]
test_data[test_data == 'NR'] = 0
test_data = test_data.to_numpy()
test_x = np.empty([240, 8*9], dtype = float)
for i in range(240):
    test_x[i, :] = test_data[8 * i: 8* (i + 1), :].reshape(1, -1)
for i in range(len(test_x)):
    for j in range(len(test_x[0])):
        if std_x[j] != 0:
            test_x[i][j] = (test_x[i][j] - mean_x[j]) / std_x[j]
test_x = np.concatenate((np.ones([240, 1]), test_x), axis = 1).astype(float)

w = np.load('weight.npy')
ans_y = np.dot(test_x, w)

import csv
with open(output_file, mode='w', newline='') as submit_file:
    csv_writer = csv.writer(submit_file)
    header = ['id', 'value']
    print(header)
    csv_writer.writerow(header)
    for i in range(240):
        row = ['id_' + str(i), ans_y[i][0]]
        csv_writer.writerow(row)
